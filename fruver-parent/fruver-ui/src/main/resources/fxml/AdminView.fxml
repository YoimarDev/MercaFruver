<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.miempresa.fruver.ui.controller.AdminController"
            stylesheets="@/css/styles.css" prefWidth="1200" prefHeight="800">

    <!-- Topbar -->
    <top>
        <HBox styleClass="topbar" alignment="CENTER_LEFT" spacing="8">
            <padding>
                <Insets top="10" right="12" bottom="10" left="12"/>
            </padding>
            <Label fx:id="lblTitle" styleClass="brand"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="Salir" onAction="#onSalir" visible="false"/>
        </HBox>
    </top>

    <!-- Center -->
    <center>
        <SplitPane orientation="HORIZONTAL" dividerPositions="0.50">
            <items>

                <!-- Panel izquierdo: Configuración de dispositivos -->
                <VBox spacing="12" prefWidth="520">
                    <padding>
                        <Insets top="12" right="12" bottom="12" left="12"/>
                    </padding>

                    <Label text="Configuración de Dispositivos" style="-fx-font-size:18px; -fx-font-weight:600;"/>

                    <GridPane hgap="8" vgap="8">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="30"/>
                            <ColumnConstraints percentWidth="70"/>
                        </columnConstraints>

                        <Label text="Tipo:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <ComboBox fx:id="cbDeviceType" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                        <Label text="Puerto:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <HBox spacing="8" GridPane.rowIndex="1" GridPane.columnIndex="1">
                            <ComboBox fx:id="cbAvailablePorts" prefWidth="200"/>
                            <TextField fx:id="txtPort" promptText="COM1 / /dev/ttyS0" HBox.hgrow="ALWAYS"/>
                        </HBox>

                        <Label text="Parámetros (JSON):" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                        <TextArea fx:id="txtParams"
                                  GridPane.rowIndex="2" GridPane.columnIndex="1"
                                  prefRowCount="4"
                                  promptText='{"baudRate":9600,"dataBits":8,"parity":"NONE"}'/>

                        <Label text="Probar lector (enfoca y escanea):" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                        <TextField fx:id="txtBarcodeTest" GridPane.rowIndex="3" GridPane.columnIndex="1" promptText="Escanea aquí para probar lector">
                            <tooltip>
                                <Tooltip text="Escanea aquí para comprobar el lector en modo keyboard. Al detectar, se guardará la configuración LECTOR (keyboard)."/>
                            </tooltip>
                        </TextField>
                    </GridPane>

                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Button fx:id="btnTest" text="Probar conexión" styleClass="primary-button" minWidth="160"/>
                        <Button fx:id="btnSave" text="Guardar configuración" styleClass="primary-button" minWidth="180"/>
                    </HBox>

                    <Label text="Configuraciones actuales:" style="-fx-font-weight:600;"/>
                    <ListView fx:id="lvConfigs" prefHeight="220" editable="false">
                        <tooltip>
                            <Tooltip text="Doble clic para cargar la configuración en los campos de edición"/>
                        </tooltip>
                    </ListView>

                    <Label fx:id="lblStatus" wrapText="true"/>
                </VBox>

                <!-- Panel derecho: Mantenimiento de BD + indicadores -->
                <VBox spacing="12">
                    <padding>
                        <Insets top="12" right="12" bottom="12" left="12"/>
                    </padding>

                    <Label text="Mantenimiento de Base de Datos" style="-fx-font-size:18px; -fx-font-weight:600;"/>
                    <Label text="Limpieza de ventas (operación destructiva). Haz backup por fuera si lo necesitas." wrapText="true"/>

                    <HBox spacing="10">
                        <Button fx:id="btnCleanSales" text="Limpiar Ventas" styleClass="primary-button" minWidth="150"/>
                    </HBox>

                    <Label text="Progreso:"/>
                    <ProgressBar fx:id="pbCleanup" prefWidth="420" progress="0"/>
                    <Label fx:id="lblCleanupStatus" wrapText="true"/>

                    <Pane VBox.vgrow="ALWAYS"/>

                    <Label text="Indicadores:" style="-fx-font-weight:600;"/>
                    <HBox spacing="20">
                        <VBox spacing="4">
                            <Label text="Báscula:"/>
                            <Label fx:id="lblScaleStatus" text="Desconocido" styleClass="device-indicator"/>
                        </VBox>
                        <VBox spacing="4">
                            <Label text="Lector:"/>
                            <Label fx:id="lblReaderStatus" text="Desconocido" styleClass="device-indicator"/>
                        </VBox>
                    </HBox>
                </VBox>

            </items>
        </SplitPane>
    </center>

    <!-- Footer -->
    <bottom>
        <HBox alignment="CENTER_RIGHT">
            <padding>
                <Insets top="10" right="12" bottom="10" left="12"/>
            </padding>
            <Label text="Admin • fruver" styleClass="version-label"/>
        </HBox>
    </bottom>

</BorderPane>
